# note that some apks can't be recompiled with older versions of apktool
# use the latest.

# to disassemble apk to smali 
apktool d filename.apk

# to rebuild apk
apktool b filename -o filename-mod.apk

# to generate keystore
keytool -genkey -v -keystore hacketh.keystore -alias takaya -keyalg RSA -keysize 2048 -validity 10000

# to sign apk
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore hacketh.keystore target.apk takaya

# to view existing images in android studio
~/Android/Sdk/emulator -list-avds

# to start emulator via cli
~/Android/Sdk/emulator @Nexus_4_API_23

# to install root manager (SuperSU) on android emulator

#1. get the right binaries and the SuperSU.apk
git clone https://github.com/0xFireball/root_avd.git

#2. run the emulator with the following arguments
~/Android/Sdk/emulator/emulator @Nexus_6_API_25 -writable-system -selinux permissive -qemu -enable-kvm

#3. remount the emulator
adb root && adb remount

#4. install SuperSU.apk, push the `su` binary and chmod
adb install SuperSU.apk && adb push su /system/xbin/su && \
adb shell --chmod 755 /system/xbin/su

#5. set SELinux to permissive, install `su` and run it as daemon
adb shell setenforce 0 && adb shell su --install && adb shell su --daemon&

#6. update the binary with `normal mode` on the apk

#7. make aliases to start the emulator with the second command

#8. also make an alias for when the emulator is running
adb root > /dev/null 2>&1 && adb shell su --daemon > /dev/null 2>&1 &

# the root is not persistent after each boot, which is why aliases will
# help a lot.
# credits to https://github.com/0xFireball/root_avd


# to get an apk from playstore via Google Play embedded emulator image
# so you can run said apk in rooted emulator

#1. download the apk from the unrooted emulator with google play
adb shell pm list packages | grep 'app'

#2. search the absolute path for the 'base.apk'
adb shell pm path com.app.something

#3. pull the 'base.apk'
adb pull fullpath/base.apk

#4. install on the rooted emulator
adb install base.apk

# to search for the time when the app loads a native library (c, c++, .so)
# search for 'loadLibrary'

# frida can take keystore's jks files and the password from the application
# after the password is recovered

# list possible aliases
keytool -keystore keystore0.jks -list

# the second command can extract the keystore
keytool -importkeystore -srckeystore keystore0.jks -destkeystore dest_pkcs12_crt.p12 -deststoretype PKCS12 -srcalias CERT_ALIAS -deststorepass YOURPASS -destkeypass YOURPASS

# credits to http://ceres-c.it/frida-android-keystore/
